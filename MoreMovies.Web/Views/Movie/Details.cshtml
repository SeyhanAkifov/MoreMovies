@model MovieDetailsViewModel
@{
    ViewData["Title"] = "Movie Details";
}

@if (Model != null)
{
    <div class="max-w-6xl mx-auto p-4 md:p-8 space-y-6">
        <!-- Titel -->
        <h1 class="text-3xl md:text-4xl font-bold text-red-600">@Model.Title</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Bild & Buttons -->
            <div class="space-y-4">
                <img src="@(string.IsNullOrEmpty(Model.ImageUrl) ? Url.Content("~/css/images/movie_placeholder.jpg") : Model.ImageUrl)"
                     alt="@Model.Title"
                     class="w-full h-64 object-cover">

                <div class="flex flex-wrap gap-2">
                    <!-- Show info button -->
                    <button id="show-info-btn" data-id="@Model.Id" class="bg-gray-800 hover:bg-gray-700 text-white px-3 py-2 rounded">
                        Show Info
                    </button>

                    @if (Model.Creator == User.Identity.Name)
                    {
                        <a asp-controller="Movie" asp-action="Edit" asp-route-id="@Model.Id" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded">
                            Edit
                        </a>
                        <a asp-controller="Movie" asp-action="Delete" asp-route-id="@Model.Id" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded">
                            Delete
                        </a>
                    }
                    else
                    {
                        @if (!Model.IsUserLiked)
                        {
                            <a asp-controller="Movie" asp-action="Like" asp-route-id="@Model.Id" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded">
                                Like
                            </a>
                        }
                        else
                        {
                            <a asp-controller="Movie" asp-action="DisLike" asp-route-id="@Model.Id" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded">
                                Dislike
                            </a>
                        }
                    }

                    <a asp-controller="Movie" asp-action="AddComment" asp-route-id="@Model.Id" class="bg-gray-600 hover:bg-gray-500 text-white px-3 py-2 rounded">
                        Write Comment
                    </a>
                </div>

                <!-- Movie Info (initially hidden) -->
                <div id="info" class="bg-gray-800 text-white p-4 rounded hidden space-y-2">
                    <p><strong>Genre:</strong> @Model.Genre</p>
                    <p><strong>Country:</strong> @Model.Country</p>
                    <p><strong>Language:</strong> @Model.Language</p>
                    <p><strong>Budget:</strong> @Model.Budget</p>
                    <p><strong>Release Date:</strong> @Model.ReleaseDate.ToString("dd MMM yyyy")</p>
                    <p>@Model.Description</p>
                    <p><a href="@Model.HomePage" class="text-red-500 hover:underline" target="_blank">Official Page</a></p>
                </div>
            </div>

            <!-- Trailer + Actors -->
            <div class="md:col-span-2 space-y-6">
                <iframe class="w-full h-64 md:h-96 rounded shadow-md" src="@Model.HomePage" title="Trailer" frameborder="0" allowfullscreen></iframe>

                <div>
                    <h2 class="text-xl font-bold text-red-500 mb-2">Actors</h2>
                    <div class="flex flex-wrap gap-2">
                        @foreach (var actor in Model.Actors)
                        {
                            <span class="bg-gray-700 px-3 py-1 rounded text-white">@actor</span>
                        }
                    </div>
                </div>

                <!-- Rating -->
                <div class="max-w-sm mx-auto p-4 bg-gray-900 text-white rounded-lg">
                    <h2 class="text-xl font-bold text-red-500 mb-2">Star Rating</h2>

                    <!-- Anzeige der aktuellen Bewertung -->
                    <div class="flex items-center mb-2">
                        @for (int i = 1; i <= 5; i++)
                        {
                            <span class="text-2xl @(i <= Model.Rating ? "text-yellow-400" : "text-gray-400")">★</span>
                        }
                        <span class="ml-2 text-gray-300 text-sm">(@Model.Rating / 5)</span>
                    </div>

                    <!-- Interaktive Sterne für neue Bewertung -->
                    <form method="post" asp-controller="Movie" asp-action="RateMovie" class="flex items-center gap-2">
                        @for (int i = 5; i >= 1; i--)
                        {
                            <input type="radio" id="star@i" name="rating" value="@i" class="hidden" />
                            <label for="star@i" class="cursor-pointer text-2xl text-yellow-400 hover:text-yellow-500 transition">★</label>
                        }
                        <input type="hidden" name="movieId" value="@Model.Id" />
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Rate</button>
                    </form>
                </div>



                <!-- Comments -->
                <div>
                    <h2 class="text-xl font-bold text-red-500 mb-2">Comments</h2>
                    <div class="space-y-4">
                        @foreach (var comment in Model.Comments)
                        {
                            <div class="bg-gray-800 p-4 rounded shadow-md">
                                <p class="font-semibold text-gray-300">@comment.UserEmail</p>
                                <p>@comment.Description</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle Movie Info
        document.getElementById('show-info-btn')?.addEventListener('click', function () {
            var info = document.getElementById('info');
            info.classList.toggle('hidden');
        });
    </script>
}
else
{
    <h1 class="text-2xl text-red-500 font-bold text-center mt-8">Movie Not Found</h1>
}
